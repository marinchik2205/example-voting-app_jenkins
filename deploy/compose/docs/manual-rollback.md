Manual Rollback Procedure (Blue/Green Deployment)
В данном проекте используется стратегия Blue/Green Deployment. Это означает, что одновременно существуют два окружения:
Blue — работает на портах 8080 (vote) и 8081 (result)

Green — работает на портах 9080 (vote) и 9081 (result)

Одно окружение считается стабильным (production), второе используется для выката новой версии приложения. Это позволяет обновлять систему без простоя.
Зачем нужен rollback
Если после деплоя нового окружения smoke-тесты не проходят или приложение работает некорректно, необходимо выполнить откат (rollback) к предыдущей стабильной версии.
В текущей реализации откат выполняется вручную через Docker Compose.
Шаг 1. Проверить активные контейнеры
Сначала нужно определить, какое окружение запущено:
docker ps --format "table {{.Names}}\t{{.Ports}}"

По портам можно понять активное окружение:

8080 / 8081 → работает Blue
9080 / 9081 → работает Green

Шаг 2. Остановить неработающее окружение
Если, например, Green деплой не прошёл smoke-тесты:
docker compose -p green -f deploy/compose/docker-compose.green.yml down

Если проблема возникла в Blue:

docker compose -p blue -f deploy/compose/docker-compose.blue.yml down

Команда down полностью останавливает и удаляет контейнеры выбранного окружения.

Шаг 3. Запустить стабильное окружение
Для возврата Blue:

docker compose -p blue -f deploy/compose/docker-compose.blue.yml up -d

Для возврата Green:

docker compose -p green -f deploy/compose/docker-compose.green.yml up -d

После запуска необходимо убедиться, что:
контейнеры имеют статус Healthy или Running
приложение доступно по соответствующим портам

Связь с автоматическим rollback
Ручной rollback демонстрирует логику возврата к стабильной версии. В CI/CD пайплайне этот процесс может быть автоматизирован: если smoke-тесты не проходят, пайплайн автоматически останавливает новое окружение и возвращает предыдущее стабильное.
Таким образом обеспечивается отказоустойчивость и минимальный простой приложения.
